import{K as e,N as s,a5 as a,k as o,l as t,c as i,w as n,e as r,o as l,a as u,d as c,g as d,t as p,h as m,i as f,O as h}from"./index-CIWIA-pi.js";import{V as g}from"./uni-cloud.es.B_W3E-Ew.js";import{_}from"./uni-easyinput.CJt8y4HP.js";import{_ as w}from"./uni-forms-item.DnUp95-v.js";import{_ as C}from"./uni-forms.M1boJhv0.js";import{_ as k}from"./uni-captcha.C7RiY6Ow.js";import{m as y}from"./login-page.mixin.Cwl58H02.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.FDEwJa58.js";import"./store.CmmNAAzQ.js";g.importObject("a_admin",{errorOptions:{type:"toast"}});const j=g.importObject("uni-id-co",{errorOptions:{type:"toast"}});const x=b({mixins:[y],data:()=>({password:"",username:"",captcha:"",needCaptcha:!1,focusUsername:!1,focusPassword:!1,logo:"/static/logo.png"}),onShow(){document.onkeydown=e=>{var s=e||window.event;s&&13==s.keyCode&&this.pwdLogin()}},methods:{toRetrievePwd(){let s="/uni_modules/uni-id-pages/pages/retrieve/retrieve";/^1\d{10}$/.test(this.username)&&(s+=`?phoneNumber=${this.username}`),e({url:s})},pwdLogin(){if(!this.password.length)return this.focusPassword=!0,s({title:"请输入密码",icon:"none",duration:3e3});if(!this.username.length)return this.focusUsername=!0,s({title:"请输入 用户名 或者 手机号",icon:"none",duration:3e3});if(this.needCaptcha&&4!=this.captcha.length)return this.$refs.captcha.getImageCaptcha(),s({title:"请输入验证码",icon:"none",duration:3e3});let e={password:this.password,captcha:this.captcha};e.username=this.username,j.login(e).then((e=>{this.loginSuccess(e),a({success:async function(e){const s=e.cid;console.log(s);const a=await j.setPushCid({pushClientId:s});console.log("amtf^setPushCid",a)},fail(e){console.log("getPushClientId出错：",e)}})})).catch((e=>{"uni-id-captcha-required"==e.errCode?this.needCaptcha=!0:this.needCaptcha&&this.$refs.captcha.getImageCaptcha()}))},toRegister(){e({url:this.config.isAdmin?"/uni_modules/uni-id-pages/pages/register/register-admin":"/uni_modules/uni-id-pages/pages/register/register",fail(e){console.error(e)}})}}},[["render",function(e,s,a,g,y,b){const j=m,x=r,V=f,P=o(t("uni-easyinput"),_),v=o(t("uni-forms-item"),w),U=o(t("uni-forms"),C),B=o(t("uni-captcha"),k),I=h;return l(),i(x,{class:"uni-content"},{default:n((()=>[u(x,{class:"login-logo"},{default:n((()=>[u(j,{src:y.logo},null,8,["src"])])),_:1}),u(V,{class:"title title-box"},{default:n((()=>[c("账号密码登录")])),_:1}),u(U,null,{default:n((()=>[u(v,{name:"username"},{default:n((()=>[u(P,{focus:y.focusUsername,onBlur:s[0]||(s[0]=e=>y.focusUsername=!1),class:"input-box",inputBorder:!1,modelValue:y.username,"onUpdate:modelValue":s[1]||(s[1]=e=>y.username=e),placeholder:"请输入 用户名 或者 手机号"},null,8,["focus","modelValue"])])),_:1}),u(v,{name:"password"},{default:n((()=>[u(P,{focus:y.focusPassword,onBlur:s[2]||(s[2]=e=>y.focusPassword=!1),class:"input-box",clearable:"",type:"password",inputBorder:!1,modelValue:y.password,"onUpdate:modelValue":s[3]||(s[3]=e=>y.password=e),placeholder:"请输入密码"},null,8,["focus","modelValue"])])),_:1})])),_:1}),y.needCaptcha?(l(),i(B,{key:0,class:"a-fanda",focus:"",ref:"captcha",scene:"login-by-pwd",modelValue:y.captcha,"onUpdate:modelValue":s[4]||(s[4]=e=>y.captcha=e)},null,8,["modelValue"])):d("",!0),u(I,{class:"uni-btn",type:"primary",onClick:b.pwdLogin},{default:n((()=>[c("登录")])),_:1},8,["onClick"]),u(x,{class:"link-box"},{default:n((()=>[e.config.isAdmin?d("",!0):(l(),i(x,{key:0},{default:n((()=>[u(V,{class:"forget"},{default:n((()=>[c("忘记了？")])),_:1}),u(V,{class:"link",onClick:b.toRetrievePwd},{default:n((()=>[c("找回密码")])),_:1},8,["onClick"])])),_:1})),u(V,{class:"link",onClick:b.toRegister},{default:n((()=>[c(p(e.config.isAdmin?"注册管理员账号":"注册账号"),1)])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-f18b72bf"]]);export{x as default};
