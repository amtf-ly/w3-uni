import{N as s,M as o,k as e,l as a,c as t,w as r,e as i,o as n,a as l,d,g as u,h as c,i as p,O as m}from"./index-CIWIA-pi.js";import{V as f}from"./uni-cloud.es.B_W3E-Ew.js";import{_ as w}from"./uni-match-media.B_T6meol.js";import{_ as h}from"./uni-easyinput.CJt8y4HP.js";import{_ as g}from"./uni-forms-item.DnUp95-v.js";import{_}from"./uni-id-pages-sms-form.gauMJo6N.js";import{_ as P}from"./uni-forms.M1boJhv0.js";import{_ as y}from"./uni-popup-captcha.DilczQtq.js";import{p as b}from"./password.DrN7_3y1.js";import{s as D,c as j,m as k}from"./store.CmmNAAzQ.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.FDEwJa58.js";import"./uni-captcha.C7RiY6Ow.js";import"./uni-popup.34yZ4x7L.js";const V=f.importObject("uni-id-co",{customUI:!0});const C=I({name:"set-pwd.vue",data:()=>({uniIdRedirectUrl:"",loginType:"",logo:"/static/logo.png",focusNewPassword:!1,focusNewPassword2:!1,allowSkip:!1,formData:{code:"",captcha:"",newPassword:"",newPassword2:""},rules:b.getPwdRules("newPassword","newPassword2")}),computed:{userInfo:()=>D.userInfo},onReady(){this.$refs.form.setRules(this.rules)},onLoad(s){var o;this.uniIdRedirectUrl=s.uniIdRedirectUrl,this.loginType=s.loginType,j.setPasswordAfterLogin&&(null==(o=j.setPasswordAfterLogin)?void 0:o.allowSkip)&&(this.allowSkip=!0)},methods:{submit(){if(!/^\d{6}$/.test(this.formData.code))return this.$refs.smsCode.focusSmsCodeInput=!0,s({title:"验证码格式不正确",icon:"none"});this.$refs.form.validate().then((s=>{V.setPwd({password:this.formData.newPassword,code:this.formData.code,captcha:this.formData.captcha}).then((s=>{o({content:"密码设置成功",showCancel:!1,success:()=>{k.loginBack({uniIdRedirectUrl:this.uniIdRedirectUrl,loginType:this.loginType})}})})).catch((s=>{o({content:s.message,showCancel:!1})}))})).catch((s=>{"uni-id-captcha-required"==s.errCode?this.$refs.popup.open():console.log(s.errMsg)})).finally((s=>{this.formData.captcha=""}))},skip(){k.loginBack({uniIdRedirectUrl:this.uniIdRedirectUrl})}}},[["render",function(s,o,f,b,D,j){const k=c,I=i,V=p,C=e(a("uni-match-media"),w),U=e(a("uni-easyinput"),h),R=e(a("uni-forms-item"),g),v=e(a("uni-id-pages-sms-form"),_),x=m,B=e(a("uni-forms"),P),N=e(a("uni-popup-captcha"),y);return n(),t(I,{class:"uni-content"},{default:r((()=>[l(C,{"min-width":690},{default:r((()=>[l(I,{class:"login-logo"},{default:r((()=>[l(k,{src:D.logo},null,8,["src"])])),_:1}),l(V,{class:"title title-box"},{default:r((()=>[d("设置密码")])),_:1})])),_:1}),l(B,{class:"set-password-form",ref:"form",value:D.formData,"err-show-type":"toast"},{default:r((()=>[l(V,{class:"tip"},{default:r((()=>[d("输入密码")])),_:1}),l(R,{name:"newPassword"},{default:r((()=>[l(U,{focus:D.focusNewPassword,onBlur:o[0]||(o[0]=s=>D.focusNewPassword=!1),class:"input-box",type:"password",inputBorder:!1,modelValue:D.formData.newPassword,"onUpdate:modelValue":o[1]||(o[1]=s=>D.formData.newPassword=s),placeholder:"请输入密码"},null,8,["focus","modelValue"])])),_:1}),l(V,{class:"tip"},{default:r((()=>[d("再次输入密码")])),_:1}),l(R,{name:"newPassword2"},{default:r((()=>[l(U,{focus:D.focusNewPassword2,onBlur:o[2]||(o[2]=s=>D.focusNewPassword2=!1),class:"input-box",type:"password",inputBorder:!1,modelValue:D.formData.newPassword2,"onUpdate:modelValue":o[3]||(o[3]=s=>D.formData.newPassword2=s),placeholder:"请再次输入新密码"},null,8,["focus","modelValue"])])),_:1}),l(v,{modelValue:D.formData.code,"onUpdate:modelValue":o[4]||(o[4]=s=>D.formData.code=s),type:"set-pwd-by-sms",ref:"smsCode",phone:j.userInfo.mobile},null,8,["modelValue","phone"]),l(I,{class:"link-box"},{default:r((()=>[l(x,{class:"uni-btn send-btn",type:"primary",onClick:j.submit},{default:r((()=>[d("确认")])),_:1},8,["onClick"]),D.allowSkip?(n(),t(x,{key:0,class:"uni-btn send-btn",type:"default",onClick:j.skip},{default:r((()=>[d("跳过")])),_:1},8,["onClick"])):u("",!0)])),_:1})])),_:1},8,["value"]),l(N,{onConfirm:j.submit,modelValue:D.formData.captcha,"onUpdate:modelValue":o[5]||(o[5]=s=>D.formData.captcha=s),scene:"set-pwd-by-sms",ref:"popup"},null,8,["onConfirm","modelValue"])])),_:1})}],["__scopeId","data-v-f34b7681"]]);export{C as default};
